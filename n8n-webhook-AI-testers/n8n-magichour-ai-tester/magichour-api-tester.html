<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Hour AI - API Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .api-config {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .api-config h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .api-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .api-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .label-info {
            font-weight: normal;
            color: #666;
            font-size: 0.85em;
            margin-left: 5px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: #f44336;
            color: white;
        }

        .btn-clear:hover {
            background: #da190b;
        }

        .btn-copy {
            background: #4caf50;
            color: white;
        }

        .btn-copy:hover {
            background: #45a049;
        }

        .output-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            grid-column: 1 / -1;
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .results-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .status-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-message {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            color: #333;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-content {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .result-item {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .result-item img,
        .result-item video {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .result-meta {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .result-meta h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2e7d32;
        }

        .output-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box h4 {
            color: #1976d2;
            margin-bottom: 8px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #555;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .info-box code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .cost-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Magic Hour AI - API Testing Interface</h1>
            <p>Test AI Image Generator & Text-to-Video with n8n Integration</p>
        </div>

        <div class="api-config">
            <h3>üîó n8n Configuration</h3>
            <div class="form-group">
                <label>n8n Webhook URL <span class="label-info">(Required - Your n8n webhook endpoint)</span></label>
                <input type="text" id="webhookUrl" placeholder="https://your-n8n-instance.com/webhook/magichour" value="">
            </div>
            <div class="info-box" style="margin-top: 15px;">
                <h4>üî¥ IMPORTANT: Your n8n Workflow MUST Return JSON (Not Binary)</h4>
                <p><strong>The webhook should return metadata, not the actual image/video file!</strong></p>
                <br>
                <h4>‚úÖ Correct n8n Workflow Structure:</h4>
                <ol style="margin-left: 20px;">
                    <li><strong>Webhook Node:</strong> Receives request from this interface</li>
                    <li><strong>HTTP Request Node:</strong> POST to Magic Hour API
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>URL: https://api.magichour.ai/v1/ai-image-generator (or text-to-video)</li>
                            <li>Auth: Bearer YOUR_MAGIC_HOUR_API_KEY</li>
                            <li>Body: <code>{{ $json.parameters }}</code></li>
                        </ul>
                    </li>
                    <li><strong>Wait Node:</strong> Wait 300 seconds</li>
                    <li><strong>HTTP Request Node (GET):</strong> Check status
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>URL: https://api.magichour.ai/v1/image-projects/<code>{{ $json.id }}</code></li>
                            <li>Auth: Same Bearer token</li>
                        </ul>
                    </li>
                    <li><strong>Respond to Webhook Node:</strong> Return the JSON response
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>‚ö†Ô∏è <strong>DO NOT</strong> download the image binary</li>
                            <li>‚úÖ <strong>RETURN</strong> the JSON with status and download URLs</li>
                            <li>Response Body: <code>{{ $json }}</code></li>
                        </ul>
                    </li>
                </ol>
                <br>
                <h4>üìã Expected JSON Response Format:</h4>
                <pre style="background: #1e1e1e; color: #d4d4d4; padding: 10px; border-radius: 5px; font-size: 0.85em; overflow-x: auto;">
{
  "status": "complete",
  "id": "clx7uu86w0a5qp55yxz315r6r",
  "downloads": [
    {
      "url": "https://cdn.magichour.ai/outputs/your-image.png"
    }
  ],
  "credits_charged": 5,
  "orientation": "landscape",
  "image_count": 1
}</pre>
                <br>
                <h4>üñºÔ∏è How Images Are Displayed:</h4>
                <p>This interface extracts the URL from <code>downloads[0].url</code> and creates an <code>&lt;img src="url"&gt;</code> tag. Your browser automatically fetches and displays the image from that URL.</p>
            </div>
        </div>

        <div class="main-grid">
            <!-- AI Image Generator Section -->
            <div class="api-section">
                <h2>üñºÔ∏è AI Image Generator</h2>
                
                <div class="info-box">
                    <h4>üìã API Details</h4>
                    <ul>
                        <li><strong>Endpoint:</strong> POST /v1/ai-image-generator</li>
                        <li><strong>Cost:</strong> 5 credits per image</li>
                        <li><strong>Max Images:</strong> 4 per request</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label>Project Name <span class="label-info">(For identification)</span></label>
                    <input type="text" id="imgName" placeholder="My AI Image" value="AI Generated Image">
                </div>

                <div class="form-group">
                    <label>Image Count <span class="label-info">(1-4 images)</span></label>
                    <input type="number" id="imgCount" min="1" max="4" value="1">
                </div>

                <div class="form-group">
                    <label>Orientation</label>
                    <select id="imgOrientation">
                        <option value="landscape">Landscape</option>
                        <option value="portrait">Portrait</option>
                        <option value="square">Square</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Style Tool <span class="label-info">(Optional art style)</span></label>
                    <select id="imgStyleTool">
                        <option value="">None (General)</option>
                        <optgroup label="AI Generators">
                            <option value="ai-anime-generator">AI Anime Generator</option>
                            <option value="ai-art-generator">AI Art Generator</option>
                            <option value="ai-background-generator">AI Background Generator</option>
                            <option value="ai-character-generator">AI Character Generator</option>
                            <option value="ai-face-generator">AI Face Generator</option>
                            <option value="ai-fashion-generator">AI Fashion Generator</option>
                            <option value="ai-icon-generator">AI Icon Generator</option>
                            <option value="ai-illustration-generator">AI Illustration Generator</option>
                            <option value="ai-interior-design-generator">AI Interior Design Generator</option>
                            <option value="ai-landscape-generator">AI Landscape Generator</option>
                            <option value="ai-logo-generator">AI Logo Generator</option>
                            <option value="ai-manga-generator">AI Manga Generator</option>
                            <option value="ai-outfit-generator">AI Outfit Generator</option>
                            <option value="ai-pattern-generator">AI Pattern Generator</option>
                            <option value="ai-photo-generator">AI Photo Generator</option>
                            <option value="ai-sketch-generator">AI Sketch Generator</option>
                            <option value="ai-tattoo-generator">AI Tattoo Generator</option>
                        </optgroup>
                        <optgroup label="Specialized Generators">
                            <option value="album-cover-generator">Album Cover Generator</option>
                            <option value="animated-characters-generator">Animated Characters Generator</option>
                            <option value="architecture-generator">Architecture Generator</option>
                            <option value="book-cover-generator">Book Cover Generator</option>
                            <option value="comic-book-generator">Comic Book Generator</option>
                            <option value="dark-fantasy-ai">Dark Fantasy AI</option>
                            <option value="disney-ai-generator">Disney AI Generator</option>
                            <option value="dnd-ai-art-generator">D&D AI Art Generator</option>
                            <option value="emoji-generator">Emoji Generator</option>
                            <option value="fantasy-map-generator">Fantasy Map Generator</option>
                            <option value="graffiti-generator">Graffiti Generator</option>
                            <option value="movie-poster-generator">Movie Poster Generator</option>
                            <option value="optical-illusion-generator">Optical Illusion Generator</option>
                            <option value="pokemon-generator">Pokemon Generator</option>
                            <option value="south-park-character-generator">South Park Character Generator</option>
                            <option value="superhero-generator">Superhero Generator</option>
                            <option value="thumbnail-maker">Thumbnail Maker</option>
                        </optgroup>
                        <option value="general">General</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Prompt <span class="label-info">(Describe what you want to generate)</span></label>
                    <textarea id="imgPrompt" placeholder="A beautiful sunset over mountains with vibrant colors and dramatic clouds">A serene landscape with mountains, lake, and sunset</textarea>
                </div>

                <div class="cost-info">
                    üí∞ <strong>Estimated Cost:</strong> <span id="imgCost">5</span> credits
                </div>

                <div class="button-group">
                    <button class="btn-generate" onclick="generateImageRequest()">üöÄ Generate Image</button>
                    <button class="btn-clear" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                </div>
            </div>

            <!-- Text-to-Video Section -->
            <div class="api-section">
                <h2>üé¨ Text-to-Video Generator</h2>
                
                <div class="info-box">
                    <h4>üìã API Details</h4>
                    <ul>
                        <li><strong>Endpoint:</strong> POST /v1/text-to-video</li>
                        <li><strong>Duration:</strong> 5-60 seconds</li>
                        <li><strong>Cost:</strong> Varies by resolution & duration</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label>Project Name <span class="label-info">(For identification)</span></label>
                    <input type="text" id="vidName" placeholder="My AI Video" value="Text to Video">
                </div>

                <div class="form-group">
                    <label>Duration (seconds) <span class="label-info">(5-60s, 480p limited to 5 or 10s)</span></label>
                    <input type="number" id="vidDuration" min="5" max="60" value="5" step="1">
                </div>

                <div class="form-group">
                    <label>Resolution</label>
                    <select id="vidResolution" onchange="updateVideoCost()">
                        <option value="480p">480p (24fps, 120 credits/5s) - Basic/Creator</option>
                        <option value="720p" selected>720p (30fps, 300 credits/5s) - Creator/Pro</option>
                        <option value="1080p">1080p (30fps, 600 credits/5s) - Pro/Business</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Orientation</label>
                    <select id="vidOrientation">
                        <option value="landscape">Landscape</option>
                        <option value="portrait">Portrait</option>
                        <option value="square">Square</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Prompt <span class="label-info">(Describe the video you want to create)</span></label>
                    <textarea id="vidPrompt" placeholder="A cinematic drone shot flying through a futuristic city at night with neon lights">A dog running through a field of flowers on a sunny day</textarea>
                </div>

                <div class="cost-info">
                    üí∞ <strong>Estimated Cost:</strong> <span id="vidCost">300</span> credits
                </div>

                <div class="button-group">
                    <button class="btn-generate" onclick="generateVideoRequest()">üöÄ Generate Video</button>
                    <button class="btn-clear" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h3>üìä Generation Results</h3>
            
            <div class="status-container" id="statusContainer">
                <div class="status-message" id="statusMessage">
                    <span>Ready to generate...</span>
                </div>
            </div>

            <div class="result-content" id="resultContent">
                <!-- Results will be displayed here -->
            </div>
        </div>

        <!-- Code Output Section -->
        <div class="output-section">
            <h3>üìù API Documentation & Code Examples</h3>
            <div class="info-box">
                <h4>‚ÑπÔ∏è How to use:</h4>
                <p>Click "üöÄ Generate Image" or "üöÄ Generate Video" buttons above to automatically populate the code examples below with your current parameters.</p>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('curl')">cURL Command</button>
                <button class="tab" onclick="switchTab('n8n')">n8n HTTP Request</button>
                <button class="tab" onclick="switchTab('json')">JSON Payload</button>
                <button class="tab" onclick="switchTab('python')">Python Code</button>
                <button class="tab" onclick="switchTab('javascript')">JavaScript Code</button>
            </div>

            <div id="curl" class="tab-content active">
                <h3>üìã cURL Command</h3>
                <div class="code-output" id="curlOutput">Click "üöÄ Generate Image" or "üöÄ Generate Video" to see cURL command...</div>
                <div class="button-group">
                    <button class="btn-copy" onclick="copyToClipboard('curlOutput')">üìã Copy cURL</button>
                </div>
            </div>

            <div id="n8n" class="tab-content">
                <h3>üîß n8n HTTP Request Configuration</h3>
                <div class="info-box">
                    <h4>How to use in n8n:</h4>
                    <ul>
                        <li>1. Add HTTP Request node to your workflow</li>
                        <li>2. Set Method to POST</li>
                        <li>3. Copy the URL below</li>
                        <li>4. Set Authentication to "Header Auth"</li>
                        <li>5. Header Name: "Authorization", Value: "Bearer YOUR_API_KEY"</li>
                        <li>6. Copy the JSON payload to the Body</li>
                        <li>7. Add a Wait node (300 seconds) after the request</li>
                        <li>8. Add another HTTP Request (GET) to fetch results using the returned ID</li>
                    </ul>
                </div>
                <div class="code-output" id="n8nOutput">Click "üöÄ Generate Image" or "üöÄ Generate Video" to see n8n configuration...</div>
                <div class="button-group">
                    <button class="btn-copy" onclick="copyToClipboard('n8nOutput')">üìã Copy Config</button>
                </div>
            </div>

            <div id="json" class="tab-content">
                <h3>üì¶ JSON Payload</h3>
                <div class="code-output" id="jsonOutput">Click "üöÄ Generate Image" or "üöÄ Generate Video" to see JSON payload...</div>
                <div class="button-group">
                    <button class="btn-copy" onclick="copyToClipboard('jsonOutput')">üìã Copy JSON</button>
                </div>
            </div>

            <div id="python" class="tab-content">
                <h3>üêç Python Code</h3>
                <div class="code-output" id="pythonOutput">Click "üöÄ Generate Image" or "üöÄ Generate Video" to see Python code...</div>
                <div class="button-group">
                    <button class="btn-copy" onclick="copyToClipboard('pythonOutput')">üìã Copy Python</button>
                </div>
            </div>

            <div id="javascript" class="tab-content">
                <h3>‚ö° JavaScript Code</h3>
                <div class="code-output" id="javascriptOutput">Click "üöÄ Generate Image" or "üöÄ Generate Video" to see JavaScript code...</div>
                <div class="button-group">
                    <button class="btn-copy" onclick="copyToClipboard('javascriptOutput')">üìã Copy JavaScript</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRequestType = '';
        let pollingInterval = null;

        // Update image cost
        document.getElementById('imgCount').addEventListener('input', function() {
            const count = parseInt(this.value) || 1;
            document.getElementById('imgCost').textContent = count * 5;
        });

        // Update video cost
        function updateVideoCost() {
            const duration = parseInt(document.getElementById('vidDuration').value) || 5;
            const resolution = document.getElementById('vidResolution').value;
            
            let costPer5Seconds = 120;
            if (resolution === '720p') costPer5Seconds = 300;
            if (resolution === '1080p') costPer5Seconds = 600;
            
            const segments = Math.ceil(duration / 5);
            const totalCost = segments * costPer5Seconds;
            
            document.getElementById('vidCost').textContent = totalCost;
        }

        document.getElementById('vidDuration').addEventListener('input', updateVideoCost);
        document.getElementById('vidResolution').addEventListener('change', updateVideoCost);

        // Show status message
        function showStatus(message, isLoading = false) {
            const statusMessage = document.getElementById('statusMessage');
            const resultsSection = document.getElementById('resultsSection');
            
            resultsSection.style.display = 'block';
            
            if (isLoading) {
                statusMessage.innerHTML = `
                    <div class="spinner"></div>
                    <span>${message}</span>
                `;
            } else {
                statusMessage.innerHTML = `<span>${message}</span>`;
            }
        }

        // Show error message
        function showError(message) {
            const resultContent = document.getElementById('resultContent');
            
            let displayMessage = message;
            try {
                const jsonMatch = message.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const errorObj = JSON.parse(jsonMatch[0]);
                    if (errorObj.message) {
                        displayMessage = errorObj.message;
                    } else if (errorObj.error) {
                        displayMessage = typeof errorObj.error === 'string' ? errorObj.error : JSON.stringify(errorObj.error, null, 2);
                    }
                }
            } catch (e) {
                // Keep original message
            }
            
            resultContent.innerHTML = `
                <div class="error-message">
                    <strong>‚ùå Error:</strong> ${displayMessage}
                    <details style="margin-top: 10px; cursor: pointer;">
                        <summary style="font-weight: bold;">Show full error details</summary>
                        <pre style="margin-top: 10px; padding: 10px; background: #fff; border-radius: 4px; overflow-x: auto; font-size: 0.85em;">${message}</pre>
                    </details>
                </div>
            `;
        }

        // Show success message
        function showSuccess(message) {
            const statusContainer = document.getElementById('statusContainer');
            statusContainer.innerHTML = `
                <div class="success-message">
                    <strong>‚úÖ Success:</strong> ${message}
                </div>
            `;
        }

        // Clear results
        function clearResults() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('resultContent').innerHTML = '';
            document.getElementById('statusMessage').innerHTML = '<span>Ready to generate...</span>';
            
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        // Display image results
        function displayImageResults(data) {
            const resultContent = document.getElementById('resultContent');
            
            if (data.downloads && data.downloads.length > 0) {
                let html = '';
                data.downloads.forEach((download, index) => {
                    html += `
                        <div class="result-item">
                            <h4>Image ${index + 1}</h4>
                            <img src="${download.url}" alt="Generated Image ${index + 1}" />
                            <div class="result-meta">
                                <h4>üìã Details:</h4>
                                <p><strong>Project ID:</strong> ${data.id}</p>
                                <p><strong>Status:</strong> ${data.status}</p>
                                <p><strong>Credits Used:</strong> ${data.credits_charged}</p>
                                <p><strong>Download:</strong> <a href="${download.url}" target="_blank">Open in new tab</a></p>
                            </div>
                        </div>
                    `;
                });
                resultContent.innerHTML = html;
                showSuccess('Image(s) generated successfully!');
            } else {
                showError('No images were generated. Please check your parameters and try again.');
            }
        }

        // Display video results
        function displayVideoResults(data) {
            const resultContent = document.getElementById('resultContent');
            
            if (data.downloads && data.downloads.length > 0) {
                const download = data.downloads[0];
                resultContent.innerHTML = `
                    <div class="result-item">
                        <h4>Generated Video</h4>
                        <video controls style="width: 100%; max-width: 800px;">
                            <source src="${download.url}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div class="result-meta">
                            <h4>üìã Details:</h4>
                            <p><strong>Project ID:</strong> ${data.id}</p>
                            <p><strong>Status:</strong> ${data.status}</p>
                            <p><strong>Duration:</strong> ${data.end_seconds}s</p>
                            <p><strong>Resolution:</strong> ${data.resolution}</p>
                            <p><strong>Credits Used:</strong> ${data.credits_charged}</p>
                            <p><strong>Download:</strong> <a href="${download.url}" target="_blank" download>Download Video</a></p>
                        </div>
                    </div>
                `;
                showSuccess('Video generated successfully!');
            } else {
                showError('No video was generated. Please check your parameters and try again.');
            }
        }

        // Poll for results
        async function pollForResults(webhookUrl, requestId, type) {
            let attempts = 0;
            const maxAttempts = 120;
            
            pollingInterval = setInterval(async () => {
                attempts++;
                
                try {
                    showStatus(`Checking status... (Attempt ${attempts}/${maxAttempts})`, true);
                    
                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'check_status',
                            request_id: requestId,
                            type: type
                        })
                    });
                    
                    // Try to get response as text first
                    const responseText = await response.text();
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${responseText}`);
                    }
                    
                    // Try to parse as JSON
                    let data;
                    try {
                        data = JSON.parse(responseText);
                    } catch (parseError) {
                        throw new Error(`Server returned non-JSON response during status check. Response: ${responseText.substring(0, 100)}`);
                    }
                    
                    if (data.status === 'complete') {
                        clearInterval(pollingInterval);
                        if (type === 'image') {
                            displayImageResults(data);
                        } else {
                            displayVideoResults(data);
                        }
                    } else if (data.status === 'error' || data.status === 'failed') {
                        clearInterval(pollingInterval);
                        showError(data.error?.message || 'Generation failed. Please try again.');
                    } else if (attempts >= maxAttempts) {
                        clearInterval(pollingInterval);
                        showError('Timeout: Generation is taking too long. Please check your n8n workflow or try again later.');
                    } else {
                        showStatus(`Processing... Status: ${data.status || 'pending'}`, true);
                    }
                    
                } catch (error) {
                    console.error('Polling error:', error);
                    if (attempts >= maxAttempts) {
                        clearInterval(pollingInterval);
                        showError(`Failed to check status: ${error.message}`);
                    }
                }
            }, 5000);
        }

        // Generate Image Request
        async function generateImageRequest() {
            const webhookUrl = document.getElementById('webhookUrl').value;
            
            if (!webhookUrl) {
                alert('Please enter your n8n Webhook URL');
                return;
            }
            
            currentRequestType = 'image';
            clearResults();
            showStatus('Sending request to n8n...', true);
            
            const name = document.getElementById('imgName').value;
            const imageCount = parseInt(document.getElementById('imgCount').value, 10);
            const orientation = document.getElementById('imgOrientation').value;
            const styleTool = document.getElementById('imgStyleTool').value;
            const prompt = document.getElementById('imgPrompt').value;

            const parameters = {
                name: name,
                image_count: imageCount,
                orientation: orientation,
                style: {
                    prompt: prompt
                }
            };

            if (styleTool && styleTool !== '') {
                parameters.style.tool = styleTool;
            }

            const payload = {
                action: 'generate',
                type: 'image',
                parameters: parameters
            };
            
            // Generate code examples immediately
            generateOutputs('https://api.magichour.ai/v1/ai-image-generator', parameters, 'YOUR_API_KEY', 'Image Generator');
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                // Try to get response as text first
                const responseText = await response.text();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }
                
                // Try to parse as JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    // Response is not JSON - might be an image or other binary data
                    throw new Error(`Server returned non-JSON response. Please check your n8n workflow. Response starts with: ${responseText.substring(0, 100)}`);
                }
                
                if (data.status === 'complete' && data.downloads) {
                    displayImageResults(data);
                } else if (data.id || data.request_id) {
                    const requestId = data.id || data.request_id;
                    showStatus('Request submitted! Waiting for generation to complete...', true);
                    pollForResults(webhookUrl, requestId, 'image');
                } else {
                    showError('Unexpected response format from n8n. Please check your workflow configuration. Response: ' + JSON.stringify(data, null, 2));
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to send request: ${error.message}`);
            }
        }

        // Generate Video Request
        async function generateVideoRequest() {
            const webhookUrl = document.getElementById('webhookUrl').value;
            
            if (!webhookUrl) {
                alert('Please enter your n8n Webhook URL');
                return;
            }
            
            currentRequestType = 'video';
            clearResults();
            showStatus('Sending request to n8n...', true);
            
            const name = document.getElementById('vidName').value;
            const endSeconds = parseFloat(document.getElementById('vidDuration').value);
            const resolution = document.getElementById('vidResolution').value;
            const orientation = document.getElementById('vidOrientation').value;
            const prompt = document.getElementById('vidPrompt').value;

            const parameters = {
                name: name,
                end_seconds: endSeconds,
                orientation: orientation,
                resolution: resolution,
                style: {
                    prompt: prompt
                }
            };

            const payload = {
                action: 'generate',
                type: 'video',
                parameters: parameters
            };
            
            // Generate code examples immediately
            generateOutputs('https://api.magichour.ai/v1/text-to-video', parameters, 'YOUR_API_KEY', 'Text-to-Video');
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                // Try to get response as text first
                const responseText = await response.text();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }
                
                // Try to parse as JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    // Response is not JSON - might be a video or other binary data
                    throw new Error(`Server returned non-JSON response. Please check your n8n workflow configuration. Response starts with: ${responseText.substring(0, 100)}`);
                }
                
                if (data.status === 'complete' && data.downloads) {
                    displayVideoResults(data);
                } else if (data.id || data.request_id) {
                    const requestId = data.id || data.request_id;
                    showStatus('Request submitted! Video generation in progress... This may take several minutes.', true);
                    pollForResults(webhookUrl, requestId, 'video');
                } else {
                    showError('Unexpected response format from n8n. Please check your workflow configuration. Response: ' + JSON.stringify(data, null, 2));
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to send request: ${error.message}`);
            }
        }

        // Generate all outputs
        function generateOutputs(url, payload, apiKey, type) {
            const jsonStr = JSON.stringify(payload, null, 2);

            // cURL
            const curlCmd = `curl --request POST \\
  --url ${url} \\
  --header 'Authorization: Bearer ${apiKey}' \\
  --header 'Content-Type: application/json' \\
  --data '${JSON.stringify(payload)}'`;
            document.getElementById('curlOutput').textContent = curlCmd;

            // n8n
            const n8nConfig = `n8n HTTP Request Node Configuration:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Method: POST
URL: ${url}

Authentication:
  Type: Header Auth
  Name: Authorization
  Value: Bearer YOUR_MAGIC_HOUR_API_KEY

Headers:
  Content-Type: application/json

Body (JSON):
${jsonStr}

Response Format: JSON

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Next Steps:
1. Add a Wait node (300 seconds)
2. Add HTTP Request (GET): https://api.magichour.ai/v1/${type === 'Image Generator' ? 'image' : 'video'}-projects/{{$json.id}}
3. Use the same Authorization header
4. Check status and download URLs in response`;
            document.getElementById('n8nOutput').textContent = n8nConfig;

            // JSON
            document.getElementById('jsonOutput').textContent = jsonStr;

            // Python
            const pythonCode = `import requests
from magic_hour import Client

# Method 1: Using Magic Hour SDK (Recommended)
client = Client(token="${apiKey}")

response = client.v1.${type === 'Text-to-Video' ? 'text_to_video' : 'ai_image_generator'}.generate(
${Object.entries(payload).map(([key, value]) => {
    if (typeof value === 'object') {
        return `    ${key}=${JSON.stringify(value, null, 4).replace(/\n/g, '\n    ')}`;
    }
    return `    ${key}=${typeof value === 'string' ? `"${value}"` : value}`;
}).join(',\n')},
    wait_for_completion=True,
    download_outputs=True,
    download_directory="./outputs/"
)

print(f"Project ID: {response.id}")
print(f"Status: {response.status}")
print(f"Downloaded files: {response.downloaded_paths}")

# Method 2: Using requests library
url = "${url}"
headers = {
    "Authorization": "Bearer ${apiKey}",
    "Content-Type": "application/json"
}

payload = ${jsonStr}

response = requests.post(url, json=payload, headers=headers)

if response.status_code == 200:
    result = response.json()
    print(f"Success! Project ID: {result['id']}")
    print(f"Credits charged: {result['credits_charged']}")
else:
    print(f"Error: {response.status_code}")
    print(response.text)`;
            document.getElementById('pythonOutput').textContent = pythonCode;

            // JavaScript
            const jsCode = `// Using fetch API
const url = "${url}";
const apiKey = "${apiKey}";

const payload = ${jsonStr};

async function generate${type.replace(/[^a-zA-Z]/g, '')}() {
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': \`Bearer \${apiKey}\`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(\`HTTP error! status: \${response.status}\`);
        }

        const result = await response.json();
        console.log('Success!');
        console.log('Project ID:', result.id);
        console.log('Credits charged:', result.credits_charged);
        
        await checkStatus(result.id);
        
    } catch (error) {
        console.error('Error:', error);
    }
}

async function checkStatus(projectId) {
    const statusUrl = \`https://api.magichour.ai/v1/${type === 'Image Generator' ? 'image' : 'video'}-projects/\${projectId}\`;
    
    let attempts = 0;
    while (attempts < 60) {
        await new Promise(resolve => setTimeout(resolve, 5000));
        
        const response = await fetch(statusUrl, {
            headers: {
                'Authorization': \`Bearer \${apiKey}\`
            }
        });
        
        const status = await response.json();
        console.log('Status:', status.status);
        
        if (status.status === 'complete') {
            console.log('Download URLs:', status.downloads);
            break;
        } else if (status.status === 'error') {
            console.error('Generation failed:', status.error);
            break;
        }
        
        attempts++;
    }
}

generate${type.replace(/[^a-zA-Z]/g, '')}();`;
            document.getElementById('javascriptOutput').textContent = jsCode;
        }

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Copy to clipboard
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                btn.style.background = '#4caf50';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Initialize
        updateVideoCost();
    </script>
</body>
</html>